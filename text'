const form = document.querySelector('.studentForm')
const table = document.querySelector('.tableDetails')

window.addEventListener('DOMContentLoaded',()=>{

    const studentsData = JSON.parse(localStorage.getItem('students'))||[];
    studentsData.forEach(student =>addStudentToTable(student))
})

form.addEventListener('submit',function(e){
    e.preventDefault()
console.log(form)

const studentName =document.getElementById('studentName').value
const studentId = document.getElementById('studentId').value
const email = document.getElementById('emailid').value
const contact = document.getElementById('Contact').value

const newStudent = {
    name:'studentName',
    Id:'studentId',
    gmail:'emailid',
    contacts:'Contact'
}

let studentData = JSON.parse(localStorage.getItem('students'))||[];
studentData.push(newStudent)
localStorage.setItem('students',JSON.stringify(studentData))
addStudentToTable(newStudent)


form.reset()


function addStudentToTable(){

    const newRow = document.createElement('tr')



    newRow.innerHTML=`
    <td><input type='text' class='inputStyle' value='${newStudent.name}' disabled/></td>
    <td><input type='number'  class='inputStyle' value='${newStudent.Id}' disabled/></td>
    <td><input type='email' class='inputStyle'  value='${newStudent.gmail}' disabled/></td>
    <td><input type='tel' class='inputStyle' value='${newStudent.contacts}' disabled/></td>
    <td><button  class='editRow'  onclick='editRow(this)' ><i class="fa-solid fa-pen"></i></button></td>
    <td><button class='editRow'  onclick='deleteRow(this)' ><i class="fa-solid fa-trash"></i></button></td>`;
   
    table.appendChild(newRow)

}



function deleteRow(button){
    const row = button.closest('tr')
    row.remove()
    updateLocalStorage();

    }

    function editRow(button){
        const row = button.closest('tr');
        const inputs = row.querySelectorAll('.inputStyle');
    
        const isDisabled = inputs[0].disabled;
    
        inputs.forEach(input => {
            input.disabled = !isDisabled;
            input.style.border = isDisabled ? 'none' : 'none';
            input.style.backgroundColor = isDisabled ? '#214179' : '#214179';
        });
    
        // Toggle button icon (edit â†” save)
        const icon = button.querySelector('i');
        icon.className = isDisabled ? 'fa-solid fa-check' : 'fa-solid fa-pen';
    }

const inputstyles = newRow.querySelectorAll('.inputStyle')

inputstyles.forEach((styles)=>{
    styles.style.border='none';
    styles.style.backgroundColor='#214179';
    styles.style.color='white'
    styles.style.margin='auto'

})


const editbtns = document.querySelectorAll('.editRow'); 

editbtns.forEach((editbtn) => {
    editbtn.style.width = '40px';
    editbtn.style.height = '30px';
    editbtn.style.backgroundColor = '#214179';
    editbtn.style.cursor = 'pointer';
    editbtn.style.borderRadius = '8px'; 
    editbtn.style.border = 'none';
    editbtn.style.color = 'white';


});





})



// Object.values(students).forEach(value=>{
   
//     const td = document.createElement('td')
//     td.textContent= value;

//     newRow.appendChild(td)

// })






function editRow(button) {
  const row = button.closest('tr');
  const inputs = row.querySelectorAll('.inputStyle');
  const icon = button.querySelector('i');
  const isDisabled = inputs[0].disabled;

  if (isDisabled) {
   
    inputs.forEach(input => {
      input.disabled = false;
      input.style.border = '1px solid white';
      input.style.backgroundColor = 'white';
      input.style.color = 'black';
    });
    icon.className = 'fa-solid fa-check';
  } else {
   
    const updatedStudent = {
      name: inputs[0].value,
      id: inputs[1].value,        
      email: inputs[2].value,     
      contact: inputs[3].value    
    };

    const originalId = row.getAttribute('data-id');
    let students = JSON.parse(localStorage.getItem('students')) || [];
    const index = students.findIndex(student => student.id === originalId); 

    if (index !== -1) {
      students[index] = updatedStudent;
      localStorage.setItem('students', JSON.stringify(students));
    }

    row.setAttribute('data-id', updatedStudent.id);

   
    inputs.forEach(input => {
      input.disabled = true;
      input.style.border = 'none';
      input.style.backgroundColor = '#214179';
      input.style.color = 'white';
    });
    icon.className = 'fa-solid fa-pen';
  }
}


function deleteRow(button){
  const row=button.closest('tr');
  const id = row.querySelectorAll('input')[1].value

  let students =JSON.parse(localStorage.getItem('students'))||[]
students = students.filter(student => student.id !== id);
  localStorage.setItem('students', JSON.stringify(students));

  row.remove();
}
  
